<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promise | example</title>
</head>

<body style="background-color: whitesmoke;">
    <div style="display: grid; place-items: center; min-height: 80vh;">
        <img src="https://images.unsplash.com/photo-1684168486204-e9e2de6811ee?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=871&q=80"
            alt="unsplash image" style="display: block; width: 550px; object-fit: cover;">
        <button id="download" style="padding: 10px 30px; cursor: pointer;">Download</button>
    </div>


    <script>

        const btn = document.getElementById("download");
        const img = document.querySelector("img");

        const link = img.src;
        // const link = img.getAttribute("src");

        function downloadPicture(url) {
            return new Promise((resolve, reject) => {
                const image = new Image();
                image.crossOrigin = "Anonymous"; // Allow cross-origin resource sharing
                image.setAttribute("src", url)
                // image.src = url;
                image.onload = function () {
                    resolve(image);
                };
                image.onerror = function () {
                    reject(new Error('Failed to download the picture.'));
                };
            });
        }

        btn.addEventListener("click", () => {
            downloadPicture(link)
                .then((image) => {
                    // Picture downloaded successfully
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = image.width;
                    canvas.height = image.height;
                    context.drawImage(image, 0, 0);

                    // Convert the canvas content to a data URL
                    const dataUrl = canvas.toDataURL("image/jpeg");

                    // Create a temporary link element and set its attributes
                    const downloadLink = document.createElement('a');
                    downloadLink.href = dataUrl;
                    downloadLink.download = img.alt + ".jpg";

                    // Simulate a click on the link to trigger the download
                    downloadLink.click();
                })
                .catch((error) => {
                    // Error occurred while downloading the picture
                    console.error('Failed to download the picture:', error);
                });
        });

    </script>

</body>

</html>